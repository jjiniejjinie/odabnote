{% extends "base.html" %}

{% block title %}{{ unit.name }} - ë¬¸ì œ ëª©ë¡ - ì˜¤ë‹µë…¸íŠ¸{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{{ url_for('workbook_list') }}">ë¬¸ì œì§‘</a>
    <span class="separator">â€º</span>
    <a href="{{ url_for('unit_list', workbook_id=unit.workbook_id) }}">{{ unit.workbook.name }}</a>
    <span class="separator">â€º</span>
    <span>{{ unit.name }}</span>
</div>

<div class="page-header">
    <div>
        <h1>ğŸ“ {{ unit.name }}</h1>
        <p class="subtitle">{{ unit.problem_count }}ê°œì˜ ë¬¸ì œ</p>
    </div>
    <div class="header-actions">
        <a href="{{ url_for('generate_problem_pdf', unit_id=unit.id) }}" 
           class="btn btn-secondary"
           title="ë‚˜ì˜ ì˜¤ë‹µ ë¬¸ì œ ëª¨ì•„ ë¬¸ì œì§€ ë§Œë“¤ê¸°">
           ğŸ“˜ ë¬¸ì œì§€ ë‹¤ìš´ë¡œë“œ</a>
        <a href="{{ url_for('generate_answer_pdf', unit_id=unit.id) }}" 
           class="btn btn-secondary"
           title="ë‚˜ì˜ ì˜¤ë‹µ ë¬¸ì œ ì •ë‹µ ëª¨ì•„ë³´ê¸°">
           ğŸ“— ì •ë‹µì§€ ë‹¤ìš´ë¡œë“œ</a>
    </div>
</div>

<div class="problem-list">
    {% if problems %}
        {% for problem in problems %}
        <div class="problem-item">
            <div class="problem-number">
                <span class="number-badge">{{ problem.problem_number }}</span>
            </div>
            
            <div class="problem-preview">
                {% if problem.problem_image_path %}
                <img src="{{ problem.problem_image_path | cloudinary_url }}" alt="ë¬¸ì œ {{ problem.problem_number }}" 
                     onclick="showImageModal('{{ problem.problem_image_path }}')">
                {% else %}
                <div class="no-image">ì´ë¯¸ì§€ ì—†ìŒ</div>
                {% endif %}
            </div>
            
            <div class="problem-info">
                <div class="problem-status">
                    {% if problem.is_text_extracted %}
                    <span class="status-badge status-success">âœ“ í…ìŠ¤íŠ¸ ì¶”ì¶œë¨</span>
                    {% else %}
                    <span class="status-badge status-pending">âŠ˜ í…ìŠ¤íŠ¸ ë¯¸ì¶”ì¶œ</span>
                    {% endif %}
                    
                    {% if problem.has_answer %}
                    <span class="status-badge status-success">âœ“ ì •ë‹µ ìˆìŒ</span>
                    {% else %}
                    <span class="status-badge status-warning">âŠ˜ ì •ë‹µ ì—†ìŒ</span>
                    {% endif %}
                </div>
                
                <div class="problem-date">
                    ì¶”ê°€ì¼: {{ problem.created_at.strftime('%Y-%m-%d %H:%M') }}
                </div>
            </div>
            
            <div class="problem-actions">
                <a href="{{ url_for('problem_detail', problem_id=problem.id) }}" 
                   class="btn btn-primary btn-sm">ìƒì„¸ë³´ê¸°</a>
                <button class="btn-icon" onclick="deleteProblem({{ problem.id }}, {{ problem.problem_number }})" 
                        title="ì‚­ì œ">ğŸ—‘ï¸</button>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“</div>
            <h3>ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>ì²« ë²ˆì§¸ ë¬¸ì œë¥¼ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
            <a href="{{ url_for('problem_add') }}" class="btn btn-primary">+ ë¬¸ì œ ì¶”ê°€</a>
        </div>
    {% endif %}
</div>

<!-- ì´ë¯¸ì§€ ëª¨ë‹¬ -->
<div id="imageModal" class="modal">
    <div class="modal-content modal-image">
        <button class="modal-close" onclick="closeModal('imageModal')">&times;</button>
        <img id="modalImage" src="" alt="ë¬¸ì œ ì´ë¯¸ì§€">
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function showImageModal(imagePath) {
    // Cloudinary URL ìƒì„±
    const cloudinaryUrl = 'https://res.cloudinary.com/dni6el4h3/image/upload/' + imagePath;
    document.getElementById('modalImage').src = cloudinaryUrl;
    document.getElementById('imageModal').style.display = 'flex';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function deleteProblem(id, number) {
    if (confirm(`ë¬¸ì œ ${number}ë²ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/problems/${id}/delete`;
        document.body.appendChild(form);
        form.submit();
    }
}

window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
    }
}
</script>
{% endblock %}
