{% extends "base.html" %}

{% block title %}ë‚´ ë¬¸ì œì§‘ - ì˜¤ë‹µë…¸íŠ¸{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ğŸ“š ë‚´ ë¬¸ì œì§‘</h1>
    <button class="btn btn-primary" onclick="showCreateModal()">+ ë¬¸ì œì§‘ ì¶”ê°€</button>
</div>

<div class="workbook-grid">
    {% if workbooks %}
        {% for workbook in workbooks %}
        <div class="workbook-card">
            <div class="workbook-card-header">
                <h3>{{ workbook.name }}</h3>
                <div class="workbook-actions">
                    <button class="btn-icon" onclick="showEditModal({{ workbook.id }}, '{{ workbook.name }}', '{{ workbook.description }}')" title="ìˆ˜ì •">âœï¸</button>
                    <button class="btn-icon" onclick="deleteWorkbook({{ workbook.id }}, '{{ workbook.name }}')" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                </div>
            </div>
            
            {% if workbook.description %}
            <p class="workbook-description">{{ workbook.description }}</p>
            {% endif %}
            
            <div class="workbook-stats">
                <span class="stat-badge">{{ workbook.units|length }}ê°œ ë‹¨ì›</span>
                <span class="stat-badge">
                    {% set total_problems = namespace(count=0) %}
                    {% for unit in workbook.units %}
                        {% set total_problems.count = total_problems.count + unit.problems|length %}
                    {% endfor %}
                    {{ total_problems.count }}ê°œ ë¬¸ì œ
                </span>
            </div>
            
            <a href="{{ url_for('unit_list', workbook_id=workbook.id) }}" class="btn btn-outline btn-block">
                ë‹¨ì› ë³´ê¸° â†’
            </a>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“š</div>
            <h3>ë¬¸ì œì§‘ì´ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>ì²« ë²ˆì§¸ ë¬¸ì œì§‘ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
            <button class="btn btn-primary" onclick="showCreateModal()">+ ë¬¸ì œì§‘ ì¶”ê°€</button>
        </div>
    {% endif %}
</div>

<!-- ë¬¸ì œì§‘ ì¶”ê°€ ëª¨ë‹¬ -->
<div id="createModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>ë¬¸ì œì§‘ ì¶”ê°€</h2>
            <button class="modal-close" onclick="closeModal('createModal')">&times;</button>
        </div>
        <form method="POST" action="{{ url_for('workbook_create') }}">
            <div class="form-group">
                <label for="name">ë¬¸ì œì§‘ ì´ë¦„ *</label>
                <input type="text" id="name" name="name" required placeholder="ì˜ˆ: ìˆ˜í•™ ì˜¤ë‹µë…¸íŠ¸">
            </div>
            <div class="form-group">
                <label for="description">ì„¤ëª…</label>
                <textarea id="description" name="description" rows="3" placeholder="ë¬¸ì œì§‘ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('createModal')">ì·¨ì†Œ</button>
                <button type="submit" class="btn btn-primary">ìƒì„±</button>
            </div>
        </form>
    </div>
</div>

<!-- ë¬¸ì œì§‘ ìˆ˜ì • ëª¨ë‹¬ -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>ë¬¸ì œì§‘ ìˆ˜ì •</h2>
            <button class="modal-close" onclick="closeModal('editModal')">&times;</button>
        </div>
        <form id="editForm" method="POST">
            <div class="form-group">
                <label for="edit_name">ë¬¸ì œì§‘ ì´ë¦„ *</label>
                <input type="text" id="edit_name" name="name" required>
            </div>
            <div class="form-group">
                <label for="edit_description">ì„¤ëª…</label>
                <textarea id="edit_description" name="description" rows="3"></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('editModal')">ì·¨ì†Œ</button>
                <button type="submit" class="btn btn-primary">ì €ì¥</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function showCreateModal() {
    document.getElementById('createModal').style.display = 'flex';
}

function showEditModal(id, name, description) {
    const modal = document.getElementById('editModal');
    const form = document.getElementById('editForm');
    
    form.action = `/workbooks/${id}/edit`;
    document.getElementById('edit_name').value = name;
    document.getElementById('edit_description').value = description;
    
    modal.style.display = 'flex';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function deleteWorkbook(id, name) {
    if (confirm(`"${name}" ë¬¸ì œì§‘ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  ë‹¨ì›ê³¼ ë¬¸ì œê°€ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.`)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/workbooks/${id}/delete`;
        document.body.appendChild(form);
        form.submit();
    }
}

// ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
    }
}
</script>
{% endblock %}
