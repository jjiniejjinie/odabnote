{% extends "base.html" %}

{% block title %}{{ workbook.name }} - ë‹¨ì› - ì˜¤ë‹µë…¸íŠ¸{% endblock %}

{% block content %}
<div class="breadcrumb">
    <a href="{{ url_for('workbook_list') }}">ë¬¸ì œì§‘</a>
    <span class="separator">â€º</span>
    <span>{{ workbook.name }}</span>
</div>

<div class="page-header">
    <div>
        <h1>ğŸ“– {{ workbook.name }}</h1>
        {% if workbook.description %}
        <p class="subtitle">{{ workbook.description }}</p>
        {% endif %}
    </div>
    <button class="btn btn-primary" onclick="showCreateModal()">+ ë‹¨ì› ì¶”ê°€</button>
</div>

<div class="unit-list">
    {% if units %}
        {% for unit in units %}
        <div class="unit-card">
            <div class="unit-header">
                <div>
                    <h3>{{ unit.name }}</h3>
                    {% if unit.description %}
                    <p class="unit-description">{{ unit.description }}</p>
                    {% endif %}
                </div>
                <div class="unit-actions">
                    <button class="btn-icon" onclick="showEditModal({{ unit.id }}, '{{ unit.name }}', '{{ unit.description }}')" title="ìˆ˜ì •">âœï¸</button>
                    <button class="btn-icon" onclick="deleteUnit({{ unit.id }}, '{{ unit.name }}')" title="ì‚­ì œ">ğŸ—‘ï¸</button>
                </div>
            </div>
            
            <div class="unit-stats">
                <span class="stat-badge">ğŸ“ {{ unit.problem_count }}ê°œ ë¬¸ì œ</span>
            </div>
            
            <a href="{{ url_for('problem_list', unit_id=unit.id) }}" class="btn btn-outline btn-block">
                ë¬¸ì œ ë³´ê¸° â†’
            </a>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“‘</div>
            <h3>ë‹¨ì›ì´ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>ì²« ë²ˆì§¸ ë‹¨ì›ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
            <button class="btn btn-primary" onclick="showCreateModal()">+ ë‹¨ì› ì¶”ê°€</button>
        </div>
    {% endif %}
</div>

<!-- ë‹¨ì› ì¶”ê°€ ëª¨ë‹¬ -->
<div id="createModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>ë‹¨ì› ì¶”ê°€</h2>
            <button class="modal-close" onclick="closeModal('createModal')">&times;</button>
        </div>
        <form method="POST" action="{{ url_for('unit_create', workbook_id=workbook.id) }}">
            <div class="form-group">
                <label for="name">ë‹¨ì› ì´ë¦„ *</label>
                <input type="text" id="name" name="name" required placeholder="ì˜ˆ: 1ë‹¨ì› - ë°©ì •ì‹">
            </div>
            <div class="form-group">
                <label for="description">ì„¤ëª…</label>
                <textarea id="description" name="description" rows="3" placeholder="ë‹¨ì›ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('createModal')">ì·¨ì†Œ</button>
                <button type="submit" class="btn btn-primary">ìƒì„±</button>
            </div>
        </form>
    </div>
</div>

<!-- ë‹¨ì› ìˆ˜ì • ëª¨ë‹¬ -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>ë‹¨ì› ìˆ˜ì •</h2>
            <button class="modal-close" onclick="closeModal('editModal')">&times;</button>
        </div>
        <form id="editForm" method="POST">
            <div class="form-group">
                <label for="edit_name">ë‹¨ì› ì´ë¦„ *</label>
                <input type="text" id="edit_name" name="name" required>
            </div>
            <div class="form-group">
                <label for="edit_description">ì„¤ëª…</label>
                <textarea id="edit_description" name="description" rows="3"></textarea>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="closeModal('editModal')">ì·¨ì†Œ</button>
                <button type="submit" class="btn btn-primary">ì €ì¥</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function showCreateModal() {
    document.getElementById('createModal').style.display = 'flex';
}

function showEditModal(id, name, description) {
    const modal = document.getElementById('editModal');
    const form = document.getElementById('editForm');
    
    form.action = `/units/${id}/edit`;
    document.getElementById('edit_name').value = name;
    document.getElementById('edit_description').value = description;
    
    modal.style.display = 'flex';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

function deleteUnit(id, name) {
    if (confirm(`"${name}" ë‹¨ì›ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nëª¨ë“  ë¬¸ì œê°€ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.`)) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = `/units/${id}/delete`;
        document.body.appendChild(form);
        form.submit();
    }
}

window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
        event.target.style.display = 'none';
    }
}
</script>
{% endblock %}
